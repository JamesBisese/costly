{% load humanize %}
{% load mathfilters %}

<style>

.result_table td  {
  border: 1px solid black;
  padding: 0px 5px 0px 5px;
}
.result_col {
  text-align: right;
  width:85px;
}
.input_col {
  background: rgb(221, 235, 247);
}
.output_col {
  background: rgb(226, 239, 218);
}
.result_table th  {
  border: 1px solid black;
  text-align:center;
  padding-left: 5px;
  padding-right: 5px;
}
.result_table {
  border-collapse: collapse;
  border-spacing: 10px;
  width: 365px;
  font-family: "Franklin ITC Light",sans-serif;
  font-weight: normal;
  font-style: normal;
  font-size: 13px;
}
.caption_table {
    width: 365px;
    font-weight: bold;
}
.cost_item_th {
    padding: 0px;
    height: 10px;
}
.structure_areas_nonconventional {
    padding-top: 10px;
}
.structure_costitem_costs_nonconventional {
    padding-top: 10px;
}
</style>


<table class="caption_table">
  <tr>
    <td>Project Title:</td>
    <td> {{ scenario.project.project_title }}</td>
  </tr>
  <tr>
    <td>Scenario Title:</td>
    <td> {{ scenario.embedded_scenario.scenario_title }}</td>
  <tr>
</tr>
</table>

 <table class="result_table">
    <td  style="width:75px;">Project Organizer</td>
    <td class="input_col"> {{ scenario.project.project_ownership_display }}</td>
  </tr>
  <tr>
    <td>Location of the project</td>
    <td class="input_col"> {{ scenario.project.project_location }}</td>
  <tr>
    <td>Project Type</td>
    <td class="input_col"> {{ scenario.project.project_type_display }}</td>
  </tr>
     {% if scenario.project.project_type == 'voluntary_redevelopment' %}
  <tr>
    <td colspan="2" style="color: red;line-height: 20px;">You have indicated that your voluntary BMP retrofit project might be
        eligible for construction material reimbursement!
        Check out the reimbursement program offered by the City of Raleigh!</td>
  </tr>
     {% endif %}
  <tr>
    <td>Purchase Information</td>
    <td class="input_col"> {{ scenario.project.project_purchase_information_display }}</td>

  </tr>
  <tr>
    <td>Total Project Area</td>
    <td class="result_col input_col"> {{ scenario.project.project_area|intcomma }} ft<sup>2</sup> ({{ scenario.project.project_area|div:43560|floatformat:2|intcomma }} Acres)</td>
  </tr>
  <tr>
    <td>Cost per ft<sup>2</sup> of Project site</td>
    <td class="result_col input_col"> ${{ scenario.project.land_unit_cost }}</td>
  </tr>
</table>
<br>
<div class="nutrient_storm_peak">
    <table class="result_table">
      <tr>
        <td>Nutrient requirements met?</td>
        <td class="input_col"> {{ scenario.embedded_scenario.nutrient_req_met_display }}</td>
      </tr>
      <tr>
        <td>Captures 90<sup>th</sup> pct storm?</td>
        <td class="input_col"> {{ scenario.embedded_scenario.captures_90pct_storm_display }}</td>
      </tr>
         {% if scenario.embedded_scenario.captures_90pct_storm == 'yes' %}
      <tr>
        <td colspan="2" style="color: red;line-height: 20px;">
            You have indicated in this scenario a design choice that might make you
            eligible for design review fee savings! Are you developing a new site?
            Check out applying for the Green Raleigh Review!
        </td>
      </tr>
         {% endif %}
      <tr>
        <td>Meets peak flow req?</td>
        <td class="input_col"



        > {{ scenario.embedded_scenario.meets_peakflow_req_display }}</td>
      </tr>
    </table>
</div>
<br>
<div class="planning_and_design">
    <table class="result_table">
      <tr>
        <td>Planning and Design Factor (Multiplier)</td>
        <td class="result_col input_col"> {{ scenario.embedded_scenario.planning_and_design_factor }}</td>
      </tr>
      <tr>
        <td>Study Life (years)</td>
        <td class="result_col input_col"> {{ scenario.embedded_scenario.study_life }}</td>
      </tr>
      <tr>
        <td>Discount Rate (DISC)</td>
        <td class="result_col input_col"> {{ scenario.embedded_scenario.discount_rate }}</td>
      </tr>
    </table>
</div>
<br>
<div class="areal_features">
    <table class="result_table">
    <thead>
      <th>Areal Feature</th>
      <th>Area ft<sup>2</sup></th>
      <th>% Project Area</th>
    </thead>
    {% for r,obj in scenario.areal_features.items %}
      {% if obj.checkbox == True and obj.area != "0" and obj.area != null %}
        <tr>
          <td> {{ obj.label }}</td>
          <td class="result_col input_col"> {{ obj.area|intcomma }}</td>
          <td class="result_col output_col"> {{ obj.area|div:scenario.project.project_area|percentage }}</td>
        </tr>
      {% endif %}
    {% endfor %}
        <tr>
          <td style="text-align: center;">Total</td>
          <td class="result_col output_col"> {{ sum_values.areal_features_sum_area|intcomma }}</td>
          <td class="result_col output_col"> {{ sum_values.areal_features_sum_area|div:scenario.project.project_area|percentage }}</td>
        </tr>
    </table>
</div>
<br>
<table class="result_table">
  <thead>
    <th>Infiltration Type</th>
    <th>Area ft<sup>2</sup></th>
    <th>% Project Area</th>
  </thead>
  <tbody>
    <tr>
      <td>Pervious Area</td>
      <td class="result_col input_col"> {{ scenario.embedded_scenario.pervious_area|intcomma   }}</td>
      <td class="result_col output_col"> {{ scenario.embedded_scenario.pervious_area|div:scenario.project.project_area|percentage }}</td>
    </tr>
    <tr>
      <td>Impervious Area</td>
      <td class="result_col input_col"> {{ scenario.embedded_scenario.impervious_area|intcomma  }}</td>
      <td class="result_col output_col"> {{ scenario.embedded_scenario.impervious_area|div:scenario.project.project_area|percentage }}</td>
    </tr>
    <tr>
      <td style="text-align: center;">Total</td>
      <td class="result_col output_col"> {{ sum_values.pervious_impervious_area|intcomma }}</td>
      <td class="result_col output_col"> {{ sum_values.pervious_impervious_area|div:scenario.project.project_area|percentage }}</td>
    </tr>
  </tbody>
</table>
<br>
<hr>

{# Structure Areas - Start This is commented out since it doesn't really make sense#}
{% if 1 == 2 %}
    {% for r, objClassification in cost_results.items %}
        <div class="structure_areas_{{ r }}">
            <table class="result_table"
                {% if r == 'conventional' %}
                    style="margin-top: 10px;"
                {% endif %}>
                <thead>
                    <th colspan="3" style="text-align: left;">
                        {% if r == 'conventional' %}
                            Conventional Structures
                        {% else %}
                            Non-Conventional (GSI) Structures
                        {% endif %}
                    </th>
                </thead>
                <thead>
                    <th>Structure</th>
                    <th>Size</th>
                    <th>% Project Area</th>
                </thead>
                {% for r,obj in objClassification.structures.items %}
                    <tr style="height: 30px;">
                      <td> {{ obj.structure.name }}</td>
                      <td class="result_col input_col"> {{ obj.structure.area|intcomma }} {{ obj.structure.units }}</td>
                      <td class="result_col output_col"> {{ obj.structure.area|div:scenario.project.project_area|percentage }}</td>
                    </tr>
                {% endfor %}
                <tr>
                  <td style="text-align: center;">Total</td>
                  <td class="result_col output_col">
                      {% if r == 'conventional' %}
                            {{ sum_values.conventional_structure_sum_area|intcomma }}
                      {% else %}
                           {{ sum_values.nonconventional_structure_sum_area|intcomma }}
                      {% endif %}
                  </td>
                  <td class="result_col output_col">
                      {% if r == 'conventional' %}
                            {{ sum_values.conventional_structure_sum_area|div:scenario.project.project_area|percentage }}
                      {% else %}
                           {{ sum_values.nonconventional_structure_sum_area|div:scenario.project.project_area|percentage }}
                      {% endif %}
                  </td>
                </tr>
            </table>
        </div>
    {% endfor %}
    <hr>
{% endif %}
{# Structure Areas - End #}



<div class="cost_item_unit_costs">
    <table class="result_table">
    <thead>
        <th>Cost Item<br>Unit Costs</th>
        <th >Units</th>
        <th >Source</th>
        <th >Cost</th>

        <th >Base Year</th>
        <th >Rep. Life</th>
        <th >O&amp;M %</th>
    </thead>
    {% for obj in cost_item_costs %}

    <tr>
        <td> {{ obj.label }}</td>
        <td > {{ obj.units }}</td>
        <td class="result_col {% if obj.cost_source == 'User' %}input_col{% else %}output_col{% endif %}"> {{ obj.cost_source }}</td>
        <td class="result_col {% if obj.cost_source == 'User' %}input_col{% else %}output_col{% endif %}"> {{ obj.unit_cost }}</td>

        <td class="result_col {% if obj.cost_source == 'User' %}input_col{% else %}output_col{% endif %}"> {{ obj.base_year }}</td>
        <td class="result_col output_col"> {{ obj.replacement_life }}</td>
        <td class="result_col output_col"> {{ obj.o_and_m_pct }}</td>
    </tr>

    {% endfor %}
    </table>
</div>
<br>
<hr>

{# Structure / Cost Item Costs - Start #}

{% for r, objClassification in cost_results.items %}
    <div class="structure_costitem_costs_{{ r }}">
        <table  class="result_table " {% if r == 'conventional' %}style="margin-top: 10px;"{% endif %}>
            <caption>Construction Costs</caption>
            <thead>
                <th colspan="2" style="text-align: left;">
                    {% if r == 'conventional' %}
                        Conventional Structures
                    {% else %}
                        Non-Conventional (GSI) Structures
                    {% endif %}
                </th>
                <th class="result_col output_col">${{ objClassification.sum_value|intcomma }}</th>
            </thead>
            <thead>
                <th class="cost_item_th">Structure</th>
                <th class="cost_item_th">Size</th>
                <th class="cost_item_th">Cost</th>
            </thead>
            {% for r,obj in objClassification.structures.items %}

                <tr style="height: 30px;">
                  <td style="font-weight: bold;"> {{ obj.structure.name }}</td>
                  <td class="result_col input_col"> {{ obj.structure.area|intcomma }} {{ obj.structure.units }}</td>
                  <td class="result_col output_col"> {{ obj.structure.sum_value }}</td>
                </tr>
                <tr>
                    <td colspan="3">
                        <table class="result_table" style="width:100%; margin-top: 2px; margin-bottom: 5px;">
                            <thead>
                                <th class="cost_item_th" style="width: 70%;">Cost Item</th>
                                <th class="cost_item_th">Cost</th>
                            </thead>
                            {% for r,objC in obj.cost_data.items %}
                                <tr>
                                    <td>{{ objC.assumptions.name }}</td>
                                    <td class="result_col output_col">{{ objC.results.value }}</td>
                                </tr>
                            {% endfor %}
                        </table>
                    </td>
                </tr>
            {% endfor %}
        </table>
    </div>
{% endfor %}
{# Structure / Cost Item Costs - End #}
<br>


<div class="final_costs">
    <table  class="result_table">

        <col style="width: 60%">
        <col style="width: 40%">
        <caption>Total Construction Costs</caption>
        <thead>
            <th class="cost_item_th">Structure Class</th>
{#            <th class="cost_item_th">Total Size</th>#}
            <th class="cost_item_th">Construction Costs</th>
        </thead>
        <tr style="height: 30px;">
          <td style="font-weight: bold;">Non-Conventional (GSI)</td>
{#          <td class="result_col input_col">111</td>#}
          <td class="result_col output_col">${{ cost_results.nonconventional.sum_value|floatformat:"0"|intcomma }}</td>
        </tr>
        <tr style="height: 30px;">
          <td style="font-weight: bold;">Conventional (GSI)</td>
{#          <td class="result_col input_col">222</td>#}
          <td class="result_col output_col">${{ cost_results.conventional.sum_value|floatformat:"0"|intcomma}}</td>
        </tr>
        <tr style="height: 30px;">
          <td style="font-weight: bold;">Total</td>
{#          <td class="result_col input_col">333</td>#}
          <td class="result_col output_col">${{ cost_results.nonconventional.sum_value|add:cost_results.conventional.sum_value|floatformat:"0"|intcomma }}</td>
        </tr>
    </table>
</div>
{# Structure / Cost Item O&M and Replacement Costs - Start #}
<hr>

{% for r, objClassification in structure_life_cycle_costs.items %}
    <div class="structure_costitem_costs_{{ r }}">
        <table  class="result_table " {% if r == 'conventional' %}style="margin-top: 10px;"{% endif %}>
            <caption>O&M and Replacement Costs</caption>
            <thead>
                <th colspan="2" style="text-align: left;">
                    {{ objClassification.meta.name }}
                </th>
                <th class="result_col output_col">{{ objClassification.costs.sum_formatted }}</th>
            </thead>
            <thead>
                <th class="cost_item_th">Structure</th>
                <th class="cost_item_th">Size</th>
                <th class="cost_item_th">Cost</th>
            </thead>
            {% for r,objStructure in objClassification.structures.items %}

                <tr style="height: 30px;">
                  <td style="font-weight: bold;"> {{ objStructure.meta.name }}  </td>
                  <td class="result_col input_col"> {{ objStructure.meta.area|intcomma }} {{ objStructure.meta.units }} </td>
                  <td class="result_col output_col">{{ objStructure.costs.sum_formatted }}</td>
                </tr>
                <tr>
                    <td colspan="3">
                        <table class="result_table" style="width:100%; margin-top: 2px; margin-bottom: 5px;">
                            <thead>
                                <th class="cost_item_th" style="width: 70%;">Cost Item</th>
                                <th class="cost_item_th">O&amp;M</th>
                                <th class="cost_item_th">Replacement</th>
                            </thead>
                            {% for r,objCostItem in objStructure.cost_items.items %}
                                <tr>
                                    <td>{{ objCostItem.meta.name }}</td>
                                    <td class="result_col output_col"> {{ objCostItem.costs.o_and_m_formatted }}  </td>
                                   <td class="result_col output_col"> {{ objCostItem.costs.replacement_formatted}} </td>
                                </tr>
                            {% endfor %}
                        </table>
                    </td>
                </tr>
            {% endfor %}
        </table>
    </div>
{% endfor %}
{# Structure / Cost Item O&M and Replacement Costs - End #}


<div class="final_costs">
    <table  class="result_table">

        <col style="width: 60%">
        <col style="width: 40%">
        <caption>Total Project Life Cycle Costs</caption>
        <thead>
            <th class="cost_item_th">Item</th>
{#            <th class="cost_item_th">Total Size</th>#}
            <th class="cost_item_th">Dollars</th>
        </thead>
        <tr style="height: 30px;">
          <td style="font-weight: bold;">Construction</td>
{#          <td class="result_col input_col">111</td>#}
          <td class="result_col output_col">${{ project_life_cycle_costs.construction|floatformat:"0"|intcomma }}</td>
        </tr>
        <tr style="height: 30px;">
          <td style="font-weight: bold;">Planning and Design</td>
{#          <td class="result_col input_col">222</td>#}
          <td class="result_col output_col">${{ project_life_cycle_costs.planning_and_design|floatformat:"0"|intcomma}}</td>
        </tr>
        <tr style="height: 30px;">
          <td style="font-weight: bold;">O&M</td>
{#          <td class="result_col input_col">333</td>#}
          <td class="result_col output_col">${{ project_life_cycle_costs.O_and_M|floatformat:"0"|intcomma }}</td>
        </tr>
        <tr style="height: 30px;">
          <td style="font-weight: bold;">Replacement</td>
{#          <td class="result_col input_col">333</td>#}
          <td class="result_col output_col">${{ project_life_cycle_costs.replacement|floatformat:"0"|intcomma }}</td>
        </tr>
        <tr style="height: 30px;">
          <td style="font-weight: bold;">Total</td>
{#          <td class="result_col input_col">333</td>#}
          <td class="result_col output_col">${{ project_life_cycle_costs.total|floatformat:"0"|intcomma }}</td>
        </tr>
    </table>
</div>