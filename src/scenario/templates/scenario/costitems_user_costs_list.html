{% extends 'base.html' %}

{% load static %}
{% block title %}{{ block.super }}User Costs{% endblock %}
{% block javascriptOLD %}
{% endblock %}

{% block extra_css %}
    <link href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/buttons/1.5.2/css/buttons.dataTables.min.css" rel="stylesheet">
{% endblock extra_css %}

{% block navbar-left %}
    {% include "_navbar.html" with active_link="audit" %}
{% endblock navbar-left %}

{% block content %}

<div style="padding-top: 20px; vertical-align:middle; line-height: 28px" >
	<span style="font-size: 38px; float:left; ">{{ header }}</span>

	<div style="clear: both;"></div>
    <br>
</div>

  <table class="table" id="user_cost-audit-table">
    <thead>
      <tr>
        <th>User</th>
        <th>User Type</th>
        <th>Cost Item</th>
        <th>Bid Units</th>
        <th>User Cost</th>
        <th>Base Year</th>
        <th>Replacement</th>
        <th>O&amp;M</th>
      </tr>
    </thead>
  </table>



{% endblock %}

{% block new_extra_js %}
    {% include "./includes/extra_js.html" %}
    {% if IIS_APP_ALIAS != '' %}
        <script>
        // add the IIS Application Alias to each of the URL values
            var IIS_APP_ALIAS = "{{ IIS_APP_ALIAS }}";
            if (IIS_APP_ALIAS.length > 0) {
                for (var key in SETTINGS.URLS) {
                    SETTINGS.URLS[key] = '/' + IIS_APP_ALIAS + SETTINGS.URLS[key];
                }
            }
        </script>
    {% endif %}

    <script>
            var table;
            $(document).ready(function() {
              table = $('#user_cost-audit-table').DataTable({
                            'serverSide': false,
                            'ajax': SETTINGS.URLS.costitems_user_costs_list + '?format=datatables',
                            'pageLength': 200,
                            "dom": 'Bfrtip',
                            "buttons": [
                                { 'extend': 'copy'},
                                { 'extend': 'csv'},
                                { 'extend': 'excel'},
                            ],
                            'columns': [
                              // Use dot notation to reference nested serializers.
                              {"data": "user.name", "searchable": true},
                              {"data": "user.profile.user_type", "searchable": true},
                              {"data": "costitem_name", "searchable": true},
                              {"data": "units", "searchable": false},
                              {"data": "user_input_cost", "searchable": false},
                              {"data": "base_year", "searchable": false},
                              {"data": "replacement_life", "searchable": false},
                              {"data": "o_and_m_pct", "searchable": false},
                            ],

                            "order": [[ 2, 'asc' ]]
                        });
            });

            table.on( 'order.dt search.dt', function () {
                table.column(0, {search:'applied', order:'applied'}).nodes().each( function (cell, i) {
                    cell.innerHTML = i+1;
                    t.cell(cell).invalidate('dom');
                } );
            } ).draw();
    </script>

{% endblock %}
